@using PagedList.Mvc;
@using HabitatForHumanity.ViewModels;
@model PagedList.StaticPagedList<HabitatForHumanity.Models.Project>
@Scripts.Render("~/bundles/jquery")
@Scripts.Render("~/bundles/bootstrap")



@Html.HiddenFor(x => x.PageNumber)
@ToolKitVM.ModalPreventDefault("editProjectModal", "Edit Project", "editPartialDiv", "editProjectForm")


<div id="" class="container" style="margin-top:25px">

    <!--Table Head-->
    <div class="row">
        <div class="col-xs-2">Project Name</div>
        <div class="col-xs-5">Description</div>
        <div class="col-xs-2">Begin Date</div>
        <div class="col-xs-3">Status</div>
    </div>

    <!--Scrollable Div-->
    <div>
        <!--Table Body-->
        @foreach (var project in Model)
        {
            var opac = 1.0;
            if (project.status == 0)
            {
                //change for disabled orgs opacity
                opac = 0.3;
            }


            var projectId = "project" + project.Id;
            <div id="@projectId" class="row well well-sm" style="margin:5px;opacity:@opac">
                <div class="col-xs-2">@project.name</div>
                <div class="col-xs-5">@project.description</div>
                <div class="col-xs-2">@project.beginDate.ToString("MM-dd-yyyy")</div>
                <div class="col-xs-3">


                    @switch (project.status)
                    {
                        case 0:
                            <label class="switch" style="float:left">
                                <input type="checkbox" class="statusSlider" projectId="@project.Id">
                                <span class="slider round"></span>
                            </label>
                            break;
                        case 1:
                            <label class="switch" style="float:left">
                                <input type="checkbox" checked="checked" class="statusSlider" projectId="@project.Id">
                                <span class="slider round"></span>
                            </label>
                            break;
                    }



                    @ToolKitVM.ModalEditButtonGlyph("editProjectButton", "editProjectModal", project.Id.ToString(), "Edit")
 
                </div>
            </div>
        }

    </div>

</div>

@ToolKitVM.ButtonScript("editProjectButton", "EditProject", "Admin", "editPartialDiv")

<script type="text/javascript">

    $(".statusSlider").click(function () {
        console.log("clicked");
        var thisSlider = $(this);
        var id = $(this).attr("projectId");


        if ($(this).is(":checked")) {
            console.log("checked");
            //then project is now active
            var status = 1;
        } else {
            //project is deactive
            var status = 0;
        }


        var data = { "id": id, "status": status }
        //  console.log($(this).attr("organizationId"));

        $.ajax({
            url: "/Admin/ChangeProjectStatus",
            type: "POST",
            data: data,
            success: function () {

                if (status == 1) {
                    var projectId = "#project" + id;
                    $(projectId).css("opacity", "1");
                } else {
                    var projectId = "#project" + id;
                    $(projectId).css("opacity", "0.3");
                }

            }
        }
        )
    });

    //changes the status of the project from active to inactive or vice versa
    $(".changeStatus").click(function () {
        var id = $(this).attr("projectId");
        var page = $("#PageNumber").attr("value");
        var query = $("#queryString").val();
        var choice = $("#statusChoiceSelector").val();
        //console.log(id);
        //console.log(page);
        //console.log(query);
        // console.log(choice);

        var data = { "id": id, "page": page, "statusChoice": choice, "queryString": query }
        $.ajax({
            url: "/Admin/ChangeProjectStatus",
            data: data,
            success: function (response) {
                // console.log(response);
                $("#projectList").replaceWith(response);
            }
        })
    });

</script>
